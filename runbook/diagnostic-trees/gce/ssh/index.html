<!doctype html><html lang=en class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.88.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel="shortcut icon" href=/favicons/favicon.ico>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192>
<title>gcpdiag</title>
<meta name=description content="
title: &ldquo;gce/Ssh&rdquo;
linkTitle: &ldquo;gce/ssh&rdquo;
weight: 3
type: docs
description: >
Provides a comprehensive analysis of common …">
<meta property="og:title" content>
<meta property="og:description" content="title: &ldquo;gce/Ssh&rdquo; linkTitle: &ldquo;gce/ssh&rdquo; weight: 3 type: docs description: > Provides a comprehensive analysis of common issues which affects SSH connectivity to VMs. Product: Compute Engine Kind: Debugging Tree
Description This runbook focuses on a range of potential problems for both Windows and Linux VMs on Google Cloud Platform. By conducting a series of checks, the runbook aims to pinpoint the root cause of SSH access difficulties.
The following areas are examined:">
<meta property="og:type" content="article">
<meta property="og:url" content="https://gcpdiag.dev/runbook/diagnostic-trees/gce/ssh/"><meta property="og:image" content="https://gcpdiag.dev/images/website-preview.jpg"><meta property="article:section" content="runbook">
<meta property="article:modified_time" content="2024-03-26T14:14:34+00:00"><meta property="og:site_name" content="gcpdiag">
<meta itemprop=name content>
<meta itemprop=description content="title: &ldquo;gce/Ssh&rdquo; linkTitle: &ldquo;gce/ssh&rdquo; weight: 3 type: docs description: > Provides a comprehensive analysis of common issues which affects SSH connectivity to VMs. Product: Compute Engine Kind: Debugging Tree
Description This runbook focuses on a range of potential problems for both Windows and Linux VMs on Google Cloud Platform. By conducting a series of checks, the runbook aims to pinpoint the root cause of SSH access difficulties.
The following areas are examined:">
<meta itemprop=dateModified content="2024-03-26T14:14:34+00:00">
<meta itemprop=wordCount content="490"><meta itemprop=image content="https://gcpdiag.dev/images/website-preview.jpg">
<meta itemprop=keywords content><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://gcpdiag.dev/images/website-preview.jpg">
<meta name=twitter:title content>
<meta name=twitter:description content="title: &ldquo;gce/Ssh&rdquo; linkTitle: &ldquo;gce/ssh&rdquo; weight: 3 type: docs description: > Provides a comprehensive analysis of common issues which affects SSH connectivity to VMs. Product: Compute Engine Kind: Debugging Tree
Description This runbook focuses on a range of potential problems for both Windows and Linux VMs on Google Cloud Platform. By conducting a series of checks, the runbook aims to pinpoint the root cause of SSH access difficulties.
The following areas are examined:">
<link href=/scss/main.css rel=stylesheet>
<script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
</head>
<body class=td-page>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-light nav-shadow flex-column flex-md-row td-navbar">
<a id=gcpdiag-top class=navbar-brand href=/>
<img src=/images/stethoscope.png height=30><span class=font-weight-bold>&nbsp;gcpdiag</span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/docs/><span>Documentation</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/rules/><span>Rules</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link active" href=/runbook/><span class=active>Runbook</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=https://github.com/GoogleCloudPlatform/gcpdiag><span>GitHub</span></a>
</li>
</ul>
</div>
<div class="navbar-nav mx-lg-2 d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off>
</div>
</nav>
</header>
<div class="container-fluid td-default td-outer">
<main role=main class=td-main>
<hr>
<h2 id=provides-a-comprehensive-analysis-of-common-issues-which-affects-ssh-connectivity-to-vms>title: &ldquo;gce/Ssh&rdquo;
linkTitle: &ldquo;gce/ssh&rdquo;
weight: 3
type: docs
description: >
Provides a comprehensive analysis of common issues which affects SSH connectivity to VMs.</h2>
<p><strong>Product</strong>: <a href=https://cloud.google.com/compute>Compute Engine</a>
<strong>Kind</strong>: Debugging Tree</p>
<h3 id=description>Description</h3>
<p>This runbook focuses on a range of potential problems for both Windows and Linux VMs on
Google Cloud Platform. By conducting a series of checks, the runbook aims to pinpoint the
root cause of SSH access difficulties.</p>
<p>The following areas are examined:</p>
<ul>
<li>
<p>VM Instance Status: Evaluates the VM&rsquo;s current state, performance - ensuring that it is running
and not impaired by high CPU usage, insufficient memory, or disk space issues that might disrupt
normal SSH operations.</p>
</li>
<li>
<p>User Permissions: Checks for the necessary Google Cloud IAM permissions that are required to
leverage OS Login features and to use metadata-based SSH keys for authentication.</p>
</li>
<li>
<p>VM Configuration: Analyzes the VM&rsquo;s metadata settings to confirm the inclusion of SSH keys,
flags and other essential configuration details that facilitate SSH access.</p>
</li>
<li>
<p>GCE Network Connectivity Tests: Reviews applicable firewall rules to verify that there are no
network barriers preventing SSH access to the VM.</p>
</li>
<li>
<p>Internal Guest OS Checks: Analysis available Guest OS metrics or logs to detect any
misconfigurations or service disruptions that could be obstructing SSH functionality.</p>
</li>
</ul>
<h3 id=executing-this-runbook>Executing this runbook</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>gcpdiag runbook gce/ssh <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  -p <span style=color:#000>project_id</span> <span style=color:#ce5c00;font-weight:700>=</span> value <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  -p <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> value <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  -p <span style=color:#000>zone</span> <span style=color:#ce5c00;font-weight:700>=</span> value <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  -p <span style=color:#000>principal</span> <span style=color:#ce5c00;font-weight:700>=</span> value <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  -p <span style=color:#000>local_user</span> <span style=color:#ce5c00;font-weight:700>=</span> value <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  -p <span style=color:#000>tunnel_through_iap</span> <span style=color:#ce5c00;font-weight:700>=</span> value <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  -p <span style=color:#000>check_os_login</span> <span style=color:#ce5c00;font-weight:700>=</span> value <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  -p <span style=color:#000>src_ip</span> <span style=color:#ce5c00;font-weight:700>=</span> value
</code></pre></div><h4 id=parameters>Parameters</h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Required</th>
<th>Default</th>
<th>Type</th>
<th>Help</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>project_id</code></td>
<td>True</td>
<td>None</td>
<td>str</td>
<td>The ID of the project hosting the VM</td>
</tr>
<tr>
<td><code>name</code></td>
<td>True</td>
<td>None</td>
<td>str</td>
<td>The name or instance ID of the target VM</td>
</tr>
<tr>
<td><code>zone</code></td>
<td>True</td>
<td>None</td>
<td>str</td>
<td>The zone of the target VM</td>
</tr>
<tr>
<td><code>principal</code></td>
<td>True</td>
<td>None</td>
<td>str</td>
<td>The user or service account principal initiating the SSH connection this user should be authenticated in gcloud/cloud console when sshing into to the GCE. For service account impersonation, it should be the service account&rsquo;s email</td>
</tr>
<tr>
<td><code>local_user</code></td>
<td>False</td>
<td>None</td>
<td>str</td>
<td>Poxis User on the VM</td>
</tr>
<tr>
<td><code>tunnel_through_iap</code></td>
<td>False</td>
<td>True</td>
<td>bool</td>
<td>(&lsquo;A boolean parameter (true or false) indicating whether &lsquo;, &lsquo;Identity-Aware Proxy should be used for establishing the SSH connection.')</td>
</tr>
<tr>
<td><code>check_os_login</code></td>
<td>False</td>
<td>True</td>
<td>bool</td>
<td>A boolean value (true or false) indicating whether OS Login should be used for SSH authentication</td>
</tr>
<tr>
<td><code>src_ip</code></td>
<td>False</td>
<td>35.235.240.0/20</td>
<td>IPv4Address</td>
<td>Source IP address. Workstation connecting from workstation,Ip of the bastion/jumphost if currently on logged on a basition/jumphost</td>
</tr>
</tbody>
</table>
<p>Get help on available commands</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>gcpdiag runbook --help
</code></pre></div><h3 id=potential-steps>Potential Steps</h3>
<ul>
<li>
<p><a href=/runbook/steps/gce/ssh-start>Ssh Start</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/vm-lifecycle-state>Vm Lifecycle State</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/vm-performance-checks>Vm Performance Checks</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/high-vm-memory-utilization>High Vm Memory Utilization</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/high-vm-disk-utilization>High Vm Disk Utilization</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/high-vm-cpu-utilization>High Vm Cpu Utilization</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/vm-guest-os-type>Vm Guest Os Type</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/linux-guest-os-checks>Linux Guest Os Checks</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/windows-guest-os-checks>Windows Guest Os Checks</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/gcp-ssh-permissions>Gcp Ssh Permissions</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/auth-principal-cloud-console-permission-check>Auth Principal Cloud Console Permission Check</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/auth-principal-has-permission-to-fetch-vm-check>Auth Principal Has Permission To Fetch Vm Check</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/os-login-status-check>Os Login Status Check</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/auth-principal-has-iap-tunnel-user-permissions-check>Auth Principal Has Iap Tunnel User Permissions Check</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/gce-firewall-allows-ssh>Gce Firewall Allows Ssh</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/gce-vpc-connectivity-check>Gce Vpc Connectivity Check</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/gce-vpc-connectivity-check>Gce Vpc Connectivity Check</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/gce-vpc-connectivity-check>Gce Vpc Connectivity Check</a></p>
</li>
<li>
<p><a href=/runbook/steps/gce/ssh-end>Ssh End</a></p>
</li>
</ul>
</main>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel=noopener href=https://github.com/GoogleCloudPlatform/gcpdiag aria-label=GitHub>
<i class="fab fa-github"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2024 Google LLC All Rights Reserved</small>
<small class=ml-1><a href=/privacy/ target=_blank rel=noopener>Privacy Policy</a></small>
</div>
</div>
</div>
</footer>
</div>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.js></script>
</body>
</html>